<p id="notice"><%= notice %></p>

<h1>Ordenes de Producción</h1>

<div class="col-12">
  <div class="col-md-3 offset-md-9">
    <%= will_paginate @ordenes_produccion, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
  </div>
</div>



<div class="col-12">
  <br>
</div>
<div class="demo">
				<h2>&lt;select&gt;</h2>
				<div class="control-group">
					<label for="select-beast">Beast:</label>
					<select id="select-beast" class="demo-default" placeholder="Select a person...">
						<option value="">Select a person...</option>
						<option value="4">Thomas Edison</option>
						<option value="1">Nikola</option>
						<option value="3">Nikola Tesla</option>
						<option value="5">Arnold Schwarzenegger</option>
					</select>
				</div>
				<script>

				</script>

<div class="">
            <button type="button"
              title="" data-toggle="popover" data-trigger="hover" data-content="buscar por parametros avanzados"
              class="btn btn-outline-success"
              id="advanced_search">
                        Busqueda Avanzada
                        <i class="ion-android-search">
                        </i>
            </button>

            <button type="button"
            title="" data-toggle="popover" data-trigger="hover"
            data-content="buscar por parametros básicos"
              class="btn btn-outline-success"
              id="simple_search">
                        Busqueda Sencilla
                        <i class="ion-android-search">
                        </i>
            </button>

</div>




<div class="formulario_busqueda_avanzada ">
  <br>
  <div class="col-12">
    <h6>Busqueda Avanzada</h6>
  </div>

<div class="">
  <br>
</div>
      <%= form_tag busquda_avanzada_produccion_path, class: 'form-inline my_card_contactos_form form-inline',remote:true do%>


        <div class="col-3">

          <label for="" align="center">Estados</label>
          <%= select_tag "estados",
              options_for_select([ "Sin Programar", "Preprensa","Impresión", "Acabado", "Cerrado", "Inventario"]),
              class:"form-control col-12",align: "center",style:"width:250px"
            %>
        </div>


          <div class="col-3">
            <label for=""></label><br>
            <%= button_tag type: 'submit', class: "btn btn-primary input-group-btn form-control" do %>
              <span>Buscar... <i></i> </span>
            <%end%>
          </div>

      <%end%>
</div>

<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover();
});
</script>

<div class="col-12">
  <br>
</div>

<div class="my_card_contactos_form" id="busqueda_basica">


          <div class="col-3">
              <div class="input-group">
                <span class="input-group-btn">
                  <button class="btn btn-secondary" type="button"> <i class="ion-ios-search-strong"></i> Go!</button>
                </span>
                <input type="text" class="form-control" placeholder="Buscar..." id="buscar_orden">
              </div>
            </div>



            <div class="col-3">

              <%= form_tag buscador_de_ordenes_por_mes_path, class: 'form-inline',remote:true,multipart: true do %> <br>

                    <div class="input-group">
                      <%=
                      select_tag "mes",
                      options_for_select([ "ENERO", "FEBRERO","MARZO", "ABRIL", "MAYO","JULIO", "AGOSTO", "SEPTIEMBRE","OCTUBRE", "NOVIEMBRE", "DICIEMBRE" ], "ENERO"),
                      class:"form-control input-group"
                      %>
                    </div>
                    <div class="input-group">
                      &nbsp;&nbsp;
                    </div>
                    <div class="input-group">
                      <%= button_tag type: 'submit', class: "btn btn-primary input-group-btn form-control" do %>
                        <span>Buscar... <i></i> </span>
                       <% end %>

                    </div>

              <% end %>

            </div>






            <div class="col-5 ">

                  <%= form_tag buscador_de_ordenes_por_fecha_path, class: 'form-inline ', remote:true, multipart: true do %>


                    <div class="my_card_contactos_form">



                          <div class="input-group">




                                    <div class="col-6">
                                        <div class="input-group">
                                          <span class="input-group-addon " id="basic-addon2"> <i class="ion-calendar"></i> </span>
                                          <%= text_field_tag 'fecha',"",class: "form-control", "data-date-format" => "dd/mm/yyyy", 'data-provide' => 'datepicker'%>

                                        </div>
                                    </div>







                                    <div class="input-group">
                                      <%= button_tag type: 'submit', class: "btn btn-primary input-group-btn form-control" do %>
                                        <span>Buscar... <i></i> </span>
                                       <% end %>

                                    </div>

                            </div>

                          </div>
                    <% end %>

            </div>




            <div class="col-1">
                <%= link_to '<button type="button" class="btn btn-dark"><i class="ion-clipboard"></i> Ver ordenes</button>'.html_safe, ordenes_produccion_path %>
            </div>



</div>
<br>
<br>
<table class="table table-hover tablesorter" id="myTable" >
  <thead>
    <tr>
      <th>Numero de orden</th>
      <th>Línea producto</th>
      <th>Cliente</th>
      <th>Descripción</th>
      <th>Linea de color</th>
      <th>Mes</th>
      <th>Fecha compromiso</th>
      <th></th>
      <th colspan="4"></th>
  </thead>

  <tbody id="bodyDeOrdenes">

    <% @ordenes_produccion.each do |orden_produccion| %>
      <tr class="ocultarBodyOrdenes order_table">
        <td><%= orden_produccion.numero_de_orden %></td>
        <td><%= orden_produccion.montaje.linea_producto.nombre%></td>
        <td><%= orden_produccion.montaje.cliente.nombre%></td>
        <td><%= orden_produccion.montaje.nombre %></td>
        <td><%=orden_produccion.montaje.linea_de_color.nombre%></td>





        <% if orden_produccion.compromisos_de_entrega.any? %>
                      <!-- true -->



                    <%



                		%>
                    <%cont=0%>
                    <%@comparador_fecha = ""%>
                    <%contador_enviados = 0%>



                    <%@hallado = false%>
                    <%@estado_data= false%>
                    <% orden_produccion.compromisos_de_entrega.each do  |fecha| %>

                            <% if fecha.fecha_de_compromiso != nil  %>
                                        <!-- true -->


                                            <%
                                              fech = fecha.fecha_de_compromiso
                                              fech.strftime("%Y/%m/%d")
                                            %>

                                            <% if fecha.enviado == true %>
                                                <%@estado_data = true%>
                                                <%contador_enviados = contador_enviados + 1%>
                                                <%@cantidades = contador_enviados%>
                                            <% end %>



                                    <%if fecha.fecha_de_compromiso < Date.today

                                          puts "******************Dia menor #{@dates}**********************"

                                          @dates= fecha.fecha_de_compromiso
                                          %>

                                    <% elsif fecha.fecha_de_compromiso >= Date.today %>

                                            <%
                                              dias = (fecha.fecha_de_compromiso - Date.today).to_i


                                              if dias == 0
                                                @dates= fecha.fecha_de_compromiso
                                                @hallado = true
                                                puts "******************Dia igual #{@dates}**********************"
                                              else
                                                if @hallado == false
                                                  @dates= fecha.fecha_de_compromiso
                                                  puts "******************Dia mayor #{@dates}**********************"
                                                end
                                              end

                                              %>


                                    <% end %>


                                    <% end %>

                          <% end %>


                              <% if @dates != nil %>
                                <!-- true -->

                              <%
                                        mes = @dates.strftime("%m")


                                        case mes
                                        when "01"%>
                                          <td>Enero</td>
                                        <%when "02"%>
                                          <td>Febrero</td>
                                        <%when "03"%>
                                          <td>Marzo</td>
                                        <%when "04"%>
                                          <td>Abril</td>
                                        <%when "05"%>
                                          <td>Mayo</td>
                                        <%when "06"%>
                                          <td>Junio</td>
                                        <%when "07"%>
                                          <td>Julio</td>
                                        <%when "08"%>
                                          <td>Agosto</td>
                                        <%when "09"%>
                                          <td>Septiembre</td>
                                        <%when "10"%>
                                          <td>Octubre</td>
                                        <%when "11"%>
                                          <td>Noviembre</td>
                                        <%when "12"%>
                                          <td>Diciembre</td>
                                        <% end %>
                                        <% else %>
                                        <td>Por Definir</td>
                                  <% end %>

                                    <td><%=@dates%> </td>

                        <% else %>
                        <td><p>Pendiente Por Definir Fecha</p> </td>
                        <td><p>Pendiente Por Definir Fecha</p> </td>
                        <% end %>

        <!-- ---------------------Estado orden_produccion Bageds ------------------------------------ -->


                  <td id=<%="estado_orden_produccion#{orden_produccion.id}"%>>





                    <% if  orden_produccion.entregado == false || orden_produccion.entregado == nil %>
                            <% if orden_produccion.sacar_de_inventario==true &&  orden_produccion.acabado== false%>
                              <!-- true -->
                              <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                <span class="badge badge-dark">
                                   Inventario
                                </span>
                              </h6>
                              <% else %>



                                    <!-- true -->
                                    <% if @estado_data == false || @estado_data == nil%>
                                      <!-- true -->

                                          <% if  orden_produccion.impresion == false%>

                                            <% if orden_produccion.pantalla == true || orden_produccion.color === true || orden_produccion.corte_material=== true && orden_produccion.acabado == false%>

                                                <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                                  <span class="badge badge-info">
                                                    Preprensa
                                                  </span>
                                                </h6>

                                            <%elsif orden_produccion.pantalla == false && orden_produccion.color === false && orden_produccion.corte_material=== false && orden_produccion.acabado == true%>

                                              <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                                <span class="badge badge-warning baged_acabado">
                                                  Acabado
                                                </span>
                                              </h6>

                                            <%elsif orden_produccion.pantalla == false && orden_produccion.color === false && orden_produccion.corte_material=== false%>

                                                <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                                  <span class="badge badge-warning">
                                                    Sin Programar
                                                  </span>
                                                </h6>



                                            <% end %>



                                          <%elsif orden_produccion.impresion == true && orden_produccion.acabado == false%>

                                            <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                              <span class="badge badge-warning baged_impresion">
                                                Impresión
                                              </span>
                                            </h6>

                                          <%elsif orden_produccion.impresion == true && orden_produccion.acabado == true%>

                                            <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                              <span class="badge badge-warning baged_acabado">
                                                Acabado
                                              </span>
                                            </h6>



                                          <% end %>

                                  <% else %>
                                  <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                                    <span class="badge badge-success ">
                                      Despachos entregados: <br>
                                      <%=@cantidades%>
                                    </span>
                                  </h6>
                                  <% end %>

                              <% end %>
                    <% else %>
                    <h6 id=<%="quitar_estado_orden_produccion#{orden_produccion.id}"%>>
                      <span class="badge badge-success ">
                        Cerrada
                      </span>
                    </h6>
                    <% end %>


                    </td>

        <td><%= link_to '<button type="button" id="crearProduccion" data-toggle="modal" data-target="" class="btn btn-outline-dark"><span><i class="ion-pull-request" aria-hidden="true"></i></span></button>'.html_safe, cambiar_proceso_url(orden_produccion), remote: true %></td>
        <td><%= link_to '<button class="btn btn-outline-info"><span><i class="ion-stats-bars"></i></span></button>'.html_safe, orden_produccion, remote: true %></td>
        <td><%= link_to '<button class="btn btn-outline-warning"><span><i class="ion-paintbrush"></i></span></button>'.html_safe, edit_orden_produccion_path(orden_produccion) %></td>
        <td><%= link_to '<button class="btn btn-outline-danger"><span><i class="ion-trash-a"></i></i></span></button>'.html_safe, orden_produccion, method: :delete, data: { confirm: 'Realmente desea eliminar esta orden de produccion?' } %></td>
      </tr>

    <% end %>
  </tbody>
</table>

<br>



<div class="container">
  <div class="row align-items-start">
    <div class="col-4">
      <%= link_to '<button type="button" class="btn btn-dark"><i class="ion-clipboard"></i> Crear orden de producción</button>'.html_safe, new_orden_produccion_path %>
    </div>
    <div class="col-4">
       <%= link_to '<button type="button"   class="btn btn-outline-success"><span><i class="fa fa-file-excel-o" aria-hidden="true"></i> Generar Excel </span></button>'.html_safe,
       ordenes_produccion_path(format: :xlsx) %>
     </div>
    <%if current_user.rol.cargo == "Administrador"%>
      <div class="col-4">
        <button class="btn btn-success" data-toggle="modal" data-target="#modalExcel">Importar ordenes de producción  desde Excel</button>
      </div>
      <div class="col-4">
         <%= link_to '<button type="button"   class="btn btn-outline-success"><span><i class="fa fa-file-excel-o" aria-hidden="true"></i> Generar Excel </span></button>'.html_safe,
         ordenes_produccion_path(format: :xlsx) %>
       </div>

    <%end%>

  </div>
</div>



<div class="col-12">
  <div class="offset-md-9">
    <%= will_paginate @ordenes_produccion, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
  </div>
</div>






<!-- Modal Excel -->

<div class="modal fade fullscreen-modal " id="modalDetalles" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content col-12">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Información Ordenes De Producción</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="" id="contenidoModal">

        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>

      </div>

    </div>
  </div>
</div>




<br>

<div class="modal fade fullscreen-modal " id="modalExcel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content col-12">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Importar Montajes Desde Excel</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <h1>Instrucciones:</h1>
          <h6> <strong>-</strong> Para importar Montajes desde Excel asegurese de que el orden las las columnas sean los siguientes: <br> &nbsp; <strong> Nombre del Cliente, Codigo del Montaje, Descripción.</strong>  </h6>
          <h6><strong>-</strong> Además El archivo tendrá que pertenecer a alguna de estas extenciones:<br> &nbsp; <strong>".xls", ".xlsx", ".csv". </strong></h6>
            <%= form_tag import_ordenes_produccion_from_excel_path, remote:true,multipart: true do %> <br>
            <%= file_field_tag :file %> <br> <br>
            <%= submit_tag "Importar", :class=> "btn btn-primary"%>
          <% end %>

        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>

      </div>

    </div>
  </div>
</div>
